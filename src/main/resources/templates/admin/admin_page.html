
<!doctype html>
<html lang="en" xmlns:th="https://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">



<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Admin page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <div class="container-fluid bg-light">
        <div class="row">
            <div class="coll-md-12 bg-dark text-white">
                <nav class="navbar navbar-dark bg-dark">
                    <span class="navbar-text-white" >

                        <span th:text="${#authentication.name}">Bob</span>
                    with roles: <span th:each="role : ${#authentication.authorities}"  th:text="${role.getAuthority().replace('ROLE_',' ')}"    >[ROLE_USER, ROLE_ADMIN]</span>

                </span>
                   <a class="float-end btn text-white-50 btn-dark  mr-sm-2 " href="/logout" >Logout <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-door-closed" viewBox="0 0 16 16">
                       <path d="M3 2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v13h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V2zm1 13h8V2H4v13z"/>
                       <path d="M9 9a1 1 0 1 0 2 0 1 1 0 0 0-2 0z"/>
                   </svg></a>
                </nav>
            </div>
        </div>

        <div class="row ">
            <div class="col-md-12 bg-white">
                <br/>
            </div>
        </div>


        <div class="row ">
            <div class="col-md-2 bg-white">
                <nav class="nav flex-column nav-pills ">
                    <a class="nav-link active" aria-current="page" href="/admin">Admin</a>
                    <a class="nav-link" aria-current="page" href="/user">User</a>
                </nav>
            </div>

            <div class="col-md-10 bg-white ">


                <h1>Admin panel</h1>

                <span class="border-top-0">

                    <nav class="nav nav-tabs" id="nav-tab" role="tablist">
  <a class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">User table</a>
  <a class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">New user</a>
</nav>
<div class="tab-content border bg-white" id="nav-tabContent">
  <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
 <div class="p-2 bg-light">All users <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-database" viewBox="0 0 16 16">
  <path d="M4.318 2.687C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4c0-.374.356-.875 1.318-1.313ZM13 5.698V7c0 .374-.356.875-1.318 1.313C10.766 8.729 9.464 9 8 9s-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777A4.92 4.92 0 0 0 13 5.698M14 4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16s3.022-.289 4.096-.777C13.125 14.755 14 14.007 14 13zm-1 4.698V10c0 .374-.356.875-1.318 1.313C10.766 11.729 9.464 12 8 12s-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10s3.022-.289 4.096-.777A4.92 4.92 0 0 0 13 8.698m0 3V13c0 .374-.356.875-1.318 1.313C10.766 14.729 9.464 15 8 15s-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13s3.022-.289 4.096-.777c.324-.147.633-.323.904-.525"/>
</svg></div>
  <table class="table table-striped">


  <thead>
    <tr>
      <th scope="col">ID</th>
      <th scope="col">First name</th>
      <th scope="col">Last name</th>
      <th scope="col">Age</th>
        <th scope="col">Email</th>
        <th scope="col">Role</th>
        <th scope="col">Edit</th>
        <th scope="col">Delete</th>
    </tr>
  </thead>
  <tbody>
    <tr th:each="user, userStat : ${usersList}">

        <td th:text="${user.id}">ID</td>
        <td th:text="${user.firstName}">First name</td>
        <td th:text="${user.lastName}">Last name</td>
        <td th:text="${user.age}">Age</td>
        <td th:text="${user.email}">Email</td>
        <td>
            <span th:each="role:${user.getRoles()}">
                <span th:text="${role.getName().replace('ROLE_' , '')}">Role</span>
            </span>
        </td>
        <td>
            <!-- Кнопка-триггер модального окна -->
<button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" th:data-bs-target="'#EditModal'+${userStat.index}" data-row="${user}">
  Edit
</button>

            <!-- Модальное окно -->
<div class="modal fade" th:id="|EditModal${userStat.index}|" th:object="${user}" tabindex="-1" role="form" aria-labelledby="EditModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="EditModalLabel">Edit user <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
  <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
  <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
</svg></h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

        <div class="modal-body">
           <!-- Форма для редактирования юзера -->
          <form action="#" th:method="PATCH" th:action="@{/admin/{id}(id=${user.getId()})}" th:object="${user}" method="POST">

          <div class="form-group">
              <label for="IDUpdate">ID</label>
              <input readonly type="text" class="form-control" id="IDUpdate" th:value="*{id}"/>
          </div>

          <div class="form-group">
              <label for="FirstNameUpdate">First name</label>
              <input type="text" class="form-control" id="FirstNameUpdate" name="firstName" th:value="*{firstName}"/>
          </div>

          <div class="form-group">
              <label for="LastNameUpdate">Last name</label>
              <input  type="text" class="form-control" id="LastNameUpdate" name="lastName" th:value="*{lastName}">
          </div>

          <div class="form-group">
              <label for="AgeUpdate">Age</label>
              <input  type="number" class="form-control" id="AgeUpdate" name="age" th:value="*{age}">
          </div>

          <div class="form-group">
              <label for="EmailUpdate">Email</label>
              <input  type="email" class="form-control" id="EmailUpdate" name="email" th:value="*{email}">
          </div>

          <div class="form-group">
              <label for="PasswordUpdate">Password</label>
              <input type="password" class="form-control" id="PasswordUpdate" name="password" th:value="*{password}">
          </div>

          <div class="form-select">
              <label for="RoleUpdate">Role</label>
              <select multiple class="form-control" id="RoleUpdate" name="roles" size="2">
                  <option th:each="role : ${rolesList}" th:value="${role.id}" th:text="${role.name.replace('ROLE_','')}">role</option>
              </select>
          </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <input type="submit" class="btn btn-primary" value="Edit">
      </div>

        </form>

    </div>
  </div>
 </div>
</div>


        </td>
        <td>
            <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" th:data-bs-target="'#DeleteModal'+${userStat.index}">
                Delete
            </button>
            <!-- Форма для удаления User -->
            <div class="modal fade" th:id="|DeleteModal${userStat.index}|" th:object="${user}" tabindex="-1" role="dialog" aria-labelledby="DeleteModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="DeleteModalLabel">Delete User <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-person-x" viewBox="0 0 16 16">
  <path d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm.256 7a4.474 4.474 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10c.26 0 .507.009.74.025.226-.341.496-.65.804-.918C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4s1 1 1 1h5.256Z"/>
  <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm-.646-4.854.646.647.646-.647a.5.5 0 0 1 .708.708l-.647.646.647.646a.5.5 0 0 1-.708.708l-.646-.647-.646.647a.5.5 0 0 1-.708-.708l.647-.646-.647-.646a.5.5 0 0 1 .708-.708Z"/>
</svg></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>

                    <div class="modal-body">
                        <form action="#" th:method="DELETE" th:action="@{/admin/{id}(id=${user.getId()})}" th:object="${user}" method="post">

          <div class="form-group">
              <label for="DeleteId">ID</label>
              <input readonly type="text" class="form-control" id="DeleteId" th:value="*{id}"/>
          </div>

          <div class="form-group">
              <label for="DeleteFirstName">First name</label>
              <input readonly type="text" class="form-control" id="DeleteFirstName" th:value="*{firstName}"/>
          </div>

          <div class="form-group">
              <label for="DeleteLastName">Last name</label>
              <input readonly type="text" class="form-control" id="DeleteLastName" th:value="*{lastName}"/>
          </div>

          <div class="form-group">
              <label for="DeleteAge">Age</label>
              <input readonly type="number" class="form-control" id="DeleteAge" th:value="*{age}"/>
          </div>

          <div class="form-group">
              <label for="DeleteEmail">Email</label>
              <input readonly type="email" class="form-control" id="DeleteEmail" th:value="*{email}"/>
          </div>

          <div class="form-group">
              <label for="DeletePassword">Password</label>
              <input readonly type="password" class="form-control" id="DeletePassword" th:value="*{password}"/>
          </div>

          <div class="form-group">
              <label for="DeleteRole">Role</label>
              <select multiple class="form-control" id="DeleteRole" size="2" disabled>
                  <option th:each="role : ${rolesList}" th:value="${role.id}" th:text="${role.name.replace('ROLE_','')}">role</option>
              </select>
          </div>

          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <input type="submit" class="btn btn-danger" value="Delete"/>
          </div>

                        </form>
                    </div>
                    </div>
                </div>
            </div>
        </td>
    </tr>
  </tbody>
</table></div>
  <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">

      <div class="tab-pane" id="new-user" role="tabpanel" aria-labelledby="new-user-tab">

            <h5 class="p-3 bg-light border-bottom">Add new user <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-person-add" viewBox="0 0 16 16">
  <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0Zm-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/>
  <path d="M8.256 14a4.474 4.474 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10c.26 0 .507.009.74.025.226-.341.496-.65.804-.918C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4s1 1 1 1h5.256Z"/>
</svg></h5>

            <div class="d-flex justify-content-center">
                <div class="col-6 text-center">

                    <form action="#" method="POST" th:method="post" th:action="@{/admin/addNewUser}">
                        <div class="form-group">
                            <label for="newUserFirstName">First name</label>
                            <input type="text" class="form-control" id="newUserFirstName"
                                   name="firstName" placeholder="First name">
                        </div>

                        <div class="form-group">
                            <label for="newUserLastName">Last name</label>
                            <input type="text" class="form-control" id="newUserLastName"
                                   name="lastName" placeholder="Last name">
                        </div>

                        <div class="form-group">
                            <label for="newUserAge">Age</label>
                            <input type="number" class="form-control" id="newUserAge"
                                   name="age" placeholder="Age">
                        </div>

                        <div class="form-group">
                            <label for="newUserEmail">Email</label>
                            <input type="email" class="form-control" id="newUserEmail"
                                   name="email" placeholder="Email">
                        </div>

                        <div class="form-group">
                            <label for="newUserPassword">Password</label>
                            <input type="password" class="form-control" id="newUserPassword"
                                   name="password" placeholder="Password">
                        </div>

                        <div class="form-group">
                            <label for="roleSelect">Role</label>
                            <select multiple class="form-control" size="2" id="roleSelect" name="roles">
                                <option th:each="role : ${rolesList}" th:value="${role.id}" th:text="${role.name.replace('ROLE_','')}">role</option>
                            </select>
                        </div>
                        <br>
                        <button type="submit" class="btn btn-success">Add new user</button>
                    </form>
                </div>
            </div>
        </div>

  </div>
</div>

                </span>

        </div>
        </div>

                </span>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
</body>
</html>